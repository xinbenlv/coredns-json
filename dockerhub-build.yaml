steps:
# Docker build step
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', 
         '--platform=linux/amd64', 
         '-t', 'gcr.io/$PROJECT_ID/coredns-json:x86_64',
         '-t', 'docker.io/xinbenlv/coredns-json:x86_64',
         '.']

# Push to Google Container Registry
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/coredns-json:x86_64']

# Push to DockerHub
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    echo "$_DOCKERHUB_PASSWORD" | docker login --username xinbenlv --password-stdin
    docker push docker.io/xinbenlv/coredns-json:x86_64

# Images to be pushed to GCR
images:
  - 'gcr.io/$PROJECT_ID/coredns-json:x86_64'

# Timeout
timeout: 1800s 